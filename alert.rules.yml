# alert.rules.yml

groups:
  - name: Alertas_Servidores_JBoss
    rules:
      # --- Regla para el uso alto de CPU ---
      - alert: UsoAltoCPU
        expr: 100 - (avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[2m])) * 100) > 85
        for: 2m
        labels:
          severity: critical
          remediation: cpu # Etiqueta clave para el enrutamiento
        annotations:
          summary: "Uso de CPU alto en {{ $labels.instance }}"
          description: "La CPU en {{ $labels.instance }} ha superado el 85% durante más de 2 minutos. Valor actual: {{ $value | printf `%.2f` }}%"

      # --- Regla para el uso alto de RAM ---
      - alert: UsoAltoRAM
        expr: (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100 < 15
        for: 2m
        labels:
          severity: critical
          remediation: ram # Etiqueta clave para el enrutamiento
        annotations:
          summary: "Uso de RAM alto en {{ $labels.instance }}"
          description: "La memoria RAM disponible en {{ $labels.instance }} es inferior al 15% durante más de 2 minutos."
